<div class="container">
  <div class="col-lg-12 p-2 d-flex align-items-center">
    <span class="material-symbols-outlined mr-5" [style.font-size]="'30px'"
      >contacts</span
    >
    <h2>Contacts</h2>
    <span class="total-count">({{ totalContacts }} Total)</span>
    <span
      class="material-symbols-outlined ms-auto"
      data-bs-toggle="tooltip"
      data-bs-placement="bottom"
      title="Add New Contact"
      [style.cursor]="'pointer'"
      (click)="onOpenCreateModal()"
      >person_add</span
    >
  </div>

  <div class="contacts">
    <div class="table-wrapper">
      <table class="table">
        <thead class="table-dark">
          <tr>
            <th scope="col">ID</th>
            <th scope="col">First Name</th>
            <th scope="col">Last Name</th>
            <th scope="col">Email</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
          @for(item of visibleContacts; track item.id) {
          <tr>
            <td class="ellipsis">{{ item.id }}</td>
            <td class="ellipsis">{{ item.firstName }}</td>
            <td class="ellipsis">{{ item.lastName }}</td>
            <td class="ellipsis">{{ item.email }}</td>
            <td>
              <span
                class="material-symbols-outlined"
                data-bs-toggle="tooltip"
                data-bs-placement="bottom"
                title="View Contact Details"
                [style.cursor]="'pointer'"
                (click)="onViewDetails(item)"
                >visibility</span
              >
            </td>
          </tr>
          } @empty {
          <p>No Contacts Found</p>
          }
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-end">
      <nav class="mt-20" aria-label="Contacts Page navigation">
        <ul class="pagination">
          <li
            class="page-item"
            [class.disabled]="currentPageNo === 1"
            [style.cursor]="currentPageNo === 1 ? 'not-allowed' : 'pointer'"
            (click)="goTo(1)"
          >
            <a class="page-link" aria-label="First Page">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
          <li
            class="page-item"
            [class.disabled]="currentPageNo === 1"
            [style.cursor]="currentPageNo === 1 ? 'not-allowed' : 'pointer'"
            (click)="goTo(currentPageNo - 1)"
          >
            <a class="page-link">Previous</a>
          </li>
          @for(page of pages; track page) {
          <li
            class="page-item"
            [style.cursor]="'pointer'"
            [class.active]="page === currentPageNo"
            (click)="goTo(page)"
          >
            <a class="page-link">{{ page }}</a>
          </li>
          }
          <li
            class="page-item"
            [class.disabled]="currentPageNo === totalPages"
            [style.cursor]="
              currentPageNo === totalPages ? 'not-allowed' : 'pointer'
            "
            (click)="goTo(currentPageNo + 1)"
          >
            <a class="page-link">Next</a>
          </li>
          <li
            class="page-item"
            [class.disabled]="currentPageNo === totalPages"
            [style.cursor]="
              currentPageNo === totalPages ? 'not-allowed' : 'pointer'
            "
            (click)="goTo(totalPages)"
          >
            <a class="page-link" aria-label="Last Page">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <div class="modal fade" id="contactModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Contact</h5>
          <button class="btn-close" (click)="closeContactModal()"></button>
        </div>

        <div class="modal-body">
          <form [formGroup]="contactForm" (ngSubmit)="submit()">
            <div class="mb-3">
              <label>First Name</label>
              <input
                class="form-control"
                formControlName="firstName"
                [class.is-invalid]="
                  contactFormControls['firstName'].invalid &&
                  contactFormControls['firstName'].touched
                "
              />
              <div class="invalid-feedback">First name is required</div>
            </div>

            <div class="mb-3">
              <label>Last Name</label>
              <input
                class="form-control"
                formControlName="lastName"
                [class.is-invalid]="
                  contactFormControls['lastName'].invalid &&
                  contactFormControls['lastName'].touched
                "
              />
              <div class="invalid-feedback">Last name is required</div>
            </div>

            <div class="mb-3">
              <label>Email</label>
              <input
                class="form-control"
                formControlName="email"
                [class.is-invalid]="
                  contactFormControls['email'].invalid &&
                  contactFormControls['email'].touched
                "
              />
              @if(contactFormControls['email'].errors?.['required']) {
              <div class="invalid-feedback">Email is required</div>
              } @else if (contactFormControls['email'].errors?.['email']) {
              <div class="invalid-feedback">Please enter a valid email</div>
              }
            </div>

            <div class="modal-footer px-0">
              <button
                type="button"
                class="btn btn-secondary"
                (click)="closeContactModal()"
              >
                Cancel
              </button>
              <button
                type="submit"
                class="btn"
                [class]="contactForm.invalid ? 'btn-light': 'btn-success'"
                [disabled]="contactForm.invalid"
                [style.cursor]="contactForm.invalid ? 'not-allowed' : 'pointer'"
              >
                Save
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
